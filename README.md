<<<<<<< HEAD
# plan-Universal
=======
# Интерактивная схема зданий с интеграцией Google Таблицы

Веб-приложение для визуализации схем этажей зданий с отображением статуса помещений (свободно/занято), информацией об арендаторах и интеграцией с Google Таблицей. Доступ к системе защищен авторизацией через логин и пароль.

## Функциональность

- Отображение схем этажей разных зданий в формате SVG
- Цветовая индикация статуса помещений (зелёный - свободно, красный - занято)
- Переключение между зданиями и этажами (поддержка зданий 19, 19-1, 19-2)
- Отображение подробной информации о помещении при клике
- Поддержка помещений с буквенными обозначениями (12а, 6б, 5в и т.д.)
- Корректное отображение помещений с одинаковыми номерами на разных этажах
- Автоматическое обновление данных из Google Таблицы
- Система авторизации для защиты доступа к приложению

## Установка и настройка

### Установка проекта

1. Скачайте или клонируйте репозиторий
2. SVG файлы схем этажей должны находиться в папке `floor_plan_svg` в корневой директории проекта
3. Убедитесь, что у вас установлен PHP (версия 7.0 или выше) для полноценной работы авторизации
4. Настройте Google Apps Script для интеграции с Google Таблицей (см. ниже)
5. Укажите URL Google Apps Script в переменной `API_URL` в файле `script.js`

### Запуск проекта

Запустите локальный сервер одним из следующих способов:

1. **С поддержкой PHP** (рекомендуется для полной функциональности авторизации):
   - Apache или Nginx с PHP модулем
   - `php -S localhost:8000` (встроенный PHP-сервер)

2. **Без поддержки PHP** (будет работать только клиентская авторизация):
   - `python -m http.server`
   - `npx http-server`
   - Используя расширение Live Server в VS Code

3. Откройте в браузере адрес `http://localhost:8000` (или другой порт, указанный при запуске сервера)

## Система авторизации

Приложение защищено двухуровневой системой авторизации:

### Учетные данные по умолчанию

- **Логин:** `admin`
- **Пароль:** `password123`

### Изменение учетных данных

Для изменения учетных данных отредактируйте файл `login.php`:

```php
// Проверяем учетные данные (замените на свои или подключите к базе данных)
$validUsername = 'admin'; // Логин
$validPassword = 'password123'; // Пароль
```

### Особенности реализации защиты

Система использует двойной механизм авторизации:
1. **На стороне клиента** - через localStorage для быстрой проверки на страницах
2. **На стороне сервера** - через PHP-сессии для надежной защиты

При запуске без PHP-сервера будет работать только клиентская авторизация. Для полноценной защиты рекомендуется использовать PHP-сервер.

### Файлы авторизации

- `login.html` - страница входа с формой для ввода логина и пароля
- `login.php` - обработчик формы входа, проверяет учетные данные и создает сессию
- `logout.php` - скрипт для корректного выхода и очистки сессии
- `index.php` - маршрутизатор для проверки авторизации и обработки запросов к файлам
- `.htaccess` - дополнительные настройки сервера для перенаправления и защиты

## Настройка Google Apps Script

1. Откройте Google Таблицу с данными о помещениях (например, https://docs.google.com/spreadsheets/d/1PPwQnjiy_UcsF0N9UDgpKkl_4wGb_eH-ixy-p4I1s-M/edit)
2. Таблица должна содержать следующие колонки:
   - Объект недвижимости (содержит номер помещения и строение)
   - Контрагент (арендатор)
   - Договор
   - Сумма (арендная плата)
   - Статус (например, "В аренде")
3. Откройте редактор скриптов (Расширения > Apps Script)
4. Создайте новый скрипт и скопируйте код из файла `google-apps-script.js`
5. Обратите внимание на ID таблицы в коде:
   ```javascript
   const spreadsheetId = '1PPwQnjiy_UcsF0N9UDgpKkl_4wGb_eH-ixy-p4I1s-M';
   ```
   Убедитесь, что он соответствует вашей таблице. Если нет, замените на ID вашей таблицы.
6. Сохраните скрипт (Ctrl+S или Файл > Сохранить)
7. Разверните приложение (Развертывание > Новое развертывание)
8. Выберите тип "Веб-приложение"
9. Установите доступ: "Все, даже анонимные" (или другой вариант в зависимости от требований)
10. Нажмите "Развернуть" и скопируйте URL приложения
11. Вставьте полученный URL в переменную `API_URL` в файле `script.js`

## Особенности Google Apps Script

Скрипт `google-apps-script.js` извлекает следующие данные из таблицы:
- Номер помещения (включая буквенные обозначения)
- Номер здания (19, 19-1, 19-2 и т.д.)
- Этаж (floor-0 для подвала, floor-1, floor-2, floor-3 и т.д.)
- Информация об арендаторе, договоре и арендной плате

Извлечение происходит с учетом следующих особенностей:
- Номер здания определяется из строки "строение XX" или "строение XX/Y" (преобразуется в XX-Y)
- Этаж определяется на основе заголовков "1 этаж", "2 этаж", "Подвал" и т.д. в таблице
- Поддерживаются помещения с буквенными обозначениями в кириллице (например, 12а, 6б)

Для тестирования скрипта можно использовать функцию `test()` или `testBuildingAndFloorExtraction()`.

## Структура SVG-файлов

SVG-файлы схем помещений расположены в папке `floor_plan_svg`.

Формат именования SVG файлов: `building-XX_floor-Y.svg`, где:
- XX - номер здания (например, 19, 19-1, 19-2)
- Y - номер этажа (0 для подвала, 1, 2, 3 и т.д.)

Каждое помещение в SVG файле должно иметь ID в формате `room-NNN`, где NNN - номер помещения (могут быть буквы, например, `room-12а`).

Примеры файлов схем:
- `floor_plan_svg/building-19_floor-0.svg` - подвал здания 19
- `floor_plan_svg/building-19_floor-1.svg` - 1 этаж здания 19
- `floor_plan_svg/building-19-1_floor-2.svg` - 2 этаж здания 19-1

## Логика клиентского скрипта

Файл `script.js` содержит следующие основные функции:

1. `checkAuth()` - проверка авторизации пользователя
2. `loadSVG(filename)` - загрузка SVG-схемы по имени файла
3. `updateRoomStatus()` - обновление цветов помещений на основе данных из таблицы
4. `displayRoomInfo(roomId)` - отображение информации о помещении при клике
5. `fetchDataFromGoogleSheets()` - получение данных из Google Таблицы через Apps Script
6. `normalizeRoomNumber(str)` - нормализация номеров помещений для корректного сравнения
7. `translateLatinToCyrillic(text)` - конвертация латинских букв (a, b, c) в кириллические (а, б, в)

Особенности обработки данных:
- Строгое сопоставление номера помещения, здания и этажа для корректного отображения
- Поддержка нормализации номеров с буквенными обозначениями
- Множественное отложенное окрашивание для надежной обработки асинхронной загрузки
- Отдельная логика отображения занятых и свободных помещений

## Отладка и тестирование

Для отладки приложения:
1. Откройте консоль браузера (F12 или Ctrl+Shift+I)
2. В консоли видны логи загрузки SVG, данных из таблицы и обработки помещений
3. При необходимости, можно использовать `getMockData()` для тестирования без подключения к Google Таблице
4. Для проверки авторизации можно:
   - Очистить localStorage и обновить страницу (должен произойти редирект на страницу входа)
   - Проверить работу с отключенным JavaScript (при наличии PHP-сервера перенаправление все равно должно работать)

## Размещение на хостинге

Для размещения на реальном хостинге:

1. Убедитесь, что хостинг поддерживает PHP (версия 7.0 или выше)
2. Загрузите все файлы проекта на хостинг через FTP или панель управления
3. Настройте домен или поддомен для проекта
4. Обязательно измените учетные данные по умолчанию в файле `login.php`
5. Для дополнительной безопасности можно настроить HTTPS

## Примечания

- В случае отсутствия соединения с Google Таблицей или URL API, приложение использует тестовые данные
- Для создания или редактирования SVG схем рекомендуется использовать Figma или другой векторный редактор
- Для корректной работы необходимо, чтобы номера помещений в SVG и в таблице совпадали
- Помещения с одинаковыми номерами на разных этажах будут правильно обрабатываться благодаря учету этажа и здания
- Все буквенные обозначения в номерах помещений должны быть на кириллице (а, б, в) 
>>>>>>> master
